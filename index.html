<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Socket.IO Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    .bubble {
      max-width: 70%;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
    }
    .bubble-user {
      background: #00e0ff;
      color: #000;
      align-self: flex-end;
    }
    .bubble-bot {
      background: #444;
      color: #fff;
      font-style: italic;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
  <!-- Kullanƒ±cƒ± adƒ± giri≈ü ekranƒ± -->
  <div id="login" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 z-50">
    <div class="bg-gray-800 p-6 rounded-xl text-center w-80">
      <h2 class="text-xl font-bold mb-4">üí¨ Chat'e Giri≈ü</h2>
      <input id="username" type="text" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z" class="w-full px-4 py-2 rounded bg-gray-700 text-white mb-4 outline-none"/>
      <button id="start" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">Giri≈ü Yap</button>
    </div>
  </div>

  <!-- Chat alanƒ± -->
  <div class="w-full max-w-2xl h-screen flex flex-col p-4">
    <div class="text-2xl font-bold mb-4 text-center">üåê Ortak Chatbox</div>
    <div id="chat" class="flex-1 overflow-y-auto space-y-2 flex flex-col p-2 border border-gray-700 rounded-xl bg-gray-800"></div>
    <form id="form" class="mt-4 flex gap-2">
      <input id="input" autocomplete="off" placeholder="Mesaj yaz..." class="flex-1 px-4 py-2 rounded bg-gray-700 text-white outline-none"/>
      <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">G√∂nder</button>
    </form>
  </div>

  <script>
    const socket = io();
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const chat = document.getElementById('chat');
    const login = document.getElementById('login');
    const usernameInput = document.getElementById('username');
    const startBtn = document.getElementById('start');

    let username = '';

    startBtn.onclick = () => {
      const name = usernameInput.value.trim();
      if (!name) return;
      username = name;
      socket.emit('set username', username);
      login.classList.add('hidden');
    };

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const msg = input.value.trim();
      if (msg) {
        socket.emit('chat message', msg);
        input.value = '';
      }
    });

    socket.on('chat message', (data) => {
      const div = document.createElement('div');
      div.className = 'bubble';
      div.classList.add(data.user === username ? 'bubble-user self-end' : data.user === 'Bot' ? 'bubble-bot self-center' : 'bg-gray-700 self-start');
      div.innerHTML = `<strong>${data.user}</strong><br>${data.text}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    });
  </script>
</body>
</html>
